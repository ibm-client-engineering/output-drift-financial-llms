# Data Preparation Guide

**Synthetic financial database generation and SEC EDGAR filing instructions**

This folder contains scripts for generating the synthetic financial data and instructions for fetching SEC 10-K filings used in the paper's evaluation experiments.

## Quick Start

```bash
# Generate synthetic financial database
python generate_toy_finance.py

# Output: toy_finance.sqlite (50 transactions for SQL task evaluation)
```

## SEC 10-K Filings (Optional)

The paper evaluates RAG tasks using actual SEC 10-K filings from Citigroup, Goldman Sachs, and JPMorgan Chase (2024). You can fetch these filings using the SEC EDGAR API.

### SEC EDGAR Compliance Requirements

**IMPORTANT**: The SEC requires all automated access to EDGAR to:
1. Declare a User-Agent header with your contact information
2. Limit requests to **10 per second** maximum
3. Review terms at https://www.sec.gov/os/accessing-edgar-data

### Minimal Scraping Example

```python
#!/usr/bin/env python3
"""
Minimal example for fetching SEC 10-K filings.
Respects SEC EDGAR policies: User-Agent declaration and rate limits.
"""
from sec_edgar_downloader import Downloader
import os

# Required: Declare your identity per SEC policy
# Format: "YourName (your@email.com)" or "CompanyName your@email.com"
USER_AGENT = os.getenv("SEC_USER_AGENT", "YourName (your@email.com)")

# Initialize downloader with required User-Agent
dl = Downloader(company_name="MyCompany", email_address=USER_AGENT)

# Fetch 10-K for JPMorgan Chase (CIK: 0000019617)
# Automatically rate-limited to comply with SEC's 10 req/sec limit
dl.get(
    filing_type="10-K",
    ticker_or_cik="JPM",
    limit=1,  # Most recent filing only
    download_details=True
)

print("✅ Downloaded to: sec-edgar-filings/JPM/10-K/")
```

### Using the sec-edgar-downloader Library

Install the library used in the example above:

```bash
pip install sec-edgar-downloader
```

**Key features:**
- Automatic rate limiting (respects SEC's 10 requests/second limit)
- CIK/ticker lookup (converts "JPM" → CIK 0000019617)
- Downloads filings with metadata (submission date, accession number)
- Saves as HTML and plain text

### SEC Tickers for Paper's Evaluation

| Company | Ticker | CIK | 2024 10-K Filing Date |
|---------|--------|-----|----------------------|
| JPMorgan Chase | JPM | 0000019617 | 2024-02-23 |
| Citigroup | C | 0000831001 | 2024-02-23 |
| Goldman Sachs | GS | 0000886982 | 2024-02-23 |

### Processing Raw Filings

The downloaded HTML files need to be converted to plain text for the RAG task. You can use libraries like BeautifulSoup and html2text:

```python
from bs4 import BeautifulSoup
import html2text

# Read raw HTML filing
with open("sec-edgar-filings/JPM/10-K/0000019617-24-000123/full-submission.txt") as f:
    html_content = f.read()

# Extract text content
soup = BeautifulSoup(html_content, "lxml")
h2t = html2text.HTML2Text()
h2t.ignore_links = True
plain_text = h2t.handle(str(soup))

# Save for RAG corpus
with open("jpm_2024_10k.txt", "w") as f:
    f.write(plain_text)
```

## Data Sources

- **Synthetic Database**: Generated via Faker library (see `generate_toy_finance.py`)
- **SEC 10-K Filings**: Fetched from SEC EDGAR API (https://www.sec.gov/edgar/search/)
- **Rate Limiting**: All scripts respect SEC's 10 requests/second limit per their terms of service

## License

All SEC EDGAR data is public domain per 17 CFR § 240.11Aa3-2. Synthetic data generated by this repository is licensed under Apache 2.0.

## References

- SEC EDGAR Access Policy: https://www.sec.gov/os/accessing-edgar-data
- SEC EDGAR Search: https://www.sec.gov/edgar/search/
- sec-edgar-downloader Library: https://github.com/jadchaar/sec-edgar-downloader
